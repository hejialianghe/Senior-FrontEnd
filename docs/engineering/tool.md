## 8.1 çœŸæœºè¿œç¨‹ä»£ç è°ƒè¯•

### 8.1.1 iosçœŸæœºè®¾å¤‡è°ƒè¯•

1. åœ¨æ‰‹æœºæ˜¯ä¸Šå¼€å¯ç½‘é¡µæ£€æŸ¥å™¨

è®¾ç½®-> safari æµè§ˆå™¨ -> é«˜çº§ -> ç½‘é¡µæ£€æµ‹å™¨

2. å¼€å¯Safariä¸Šçš„DevelopåŠŸèƒ½

èœå• -> Preferencesï¼ˆåå¥½è®¾ç½®ï¼‰ -> Advancedï¼ˆé«˜çº§ï¼‰

![](~@/engineering/devetoopios.png)

3. ä½¿ç”¨æ•°æ®çº¿è¿æ¥æ‰‹æœºä¸ªå¼€å‘ä¸»æœº

- ä¿¡ä»»ç”µè„‘

4. æ‰“å¼€devTool

Develop -> ä½ çš„iosè®¾å¤‡ -> è¦è°ƒè¯•çš„é¡µé¢

![](~@/engineering/connect.png)

### 8.1.2 AndroidçœŸæœºè®¾å¤‡è°ƒè¯•

1. åœ¨æ‰‹æœºä¸Šå¼€å¯USBè°ƒè¯•åŠŸèƒ½

è®¾ç½®-> å¼€å‘è€…é€‰é¡¹ -> USBè°ƒè¯•

2. ä½¿ç”¨æ•°æ®çº¿è¿æ¥æ‰‹æœºå’Œå¼€å‘ä¸»æœº

- å…è®¸USBè°ƒè¯•

3. æ‰“å¼€Chrome DevTools

- åœ¨åœ°å€æ è¾“å…¥chrome://inspect
- ç¡®ä¿å¼€å¯äº† Discover USB devices

![](~@/engineering/andconnect.png)

## 8.2 æ— çº¿è°ƒè¯•å·¥å…·-Weinre

- æ— éœ€æ•°æ®çº¿
- pcå’Œç§»åŠ¨éƒ½å¯ä»¥è°ƒè¯•

1. ç¯å¢ƒå‡†å¤‡ä¸å®‰è£…

- ç¯å¢ƒï¼šä»»ä½•node.js ç¯å¢ƒ
- å®‰è£…ï¼š`npm install -g weinre`

```bash
 weinre -h  #è·å–å¸®åŠ©ä¿¡æ¯
 weinre --boundHost=-all- --httpPort=1000 # å¯åŠ¨ï¼ŒboundHostä¸ºallæ˜¯å…è®¸æœ¬æœºæ‰€æœ‰æœ‰æ•ˆipè®¿é—®ï¼Œé»˜è®¤ç«¯å£8080
```
- æµè§ˆæ‰“å¼€ï¼šip:1000 æˆ– http://localhost:1000/

![](~@/engineering/weinre.png)

2. Target é¡µé¢é…ç½®

```html
<!-- å¾€è¢«è°ƒè¯•é¡µé¢æ·»åŠ è„šæœ¬ -->
<script src="http://ip:ç«¯å£/target/target-script-min.js#anonymous"></script>
<!-- ç¤ºä¾‹ -->
<script src="http://172.20.10.11:1000/target/target-script-min.js#anonymous"></script>
```

3. è°ƒè¯•

è°ƒè¯•ç§»åŠ¨æ‰‹æœºçš„é¡µé¢éœ€è¦æ‰‹æœºè®¿é—®å±€åŸŸç½‘å†…çš„é¡µé¢æœåŠ¡ï¼ˆä¾‹å¦‚reactå¼€å¯äº†3000ç«¯å£çš„æœåŠ¡ï¼Œé‚£ä¹ˆæ‰‹æœºè®¿é—®ip+3000ï¼‰

![](~@/engineering/weinreremote.png)

æ‰©å±•

[weinreå®˜ç½‘](https://people.apache.org/~pmuellr/weinre/docs/latest/Home.html)

##  8.3 åœ¨ç§»åŠ¨ç«¯è°ƒè¯•

ä¸»æµçš„ç§»åŠ¨ç«¯devTool

- vConsole
- eruda

æ‰©å±•èµ„æ–™

[vConsoleé¡¹ç›®ä¸»é¡µ](https://github.com/Tencent/vConsole)

[erudaé¡¹ç›®ä¸»é¡µ](https://github.com/liriliri/eruda)

[åˆ›å»ºä¸€ä¸ªvConsole æ’ä»¶](https://github.com/Tencent/vConsole/blob/dev/doc/plugin_building_a_plugin.md)


##  8.4 ä½¿ç”¨ä»£ç†æœåŠ¡å™¨è¿›è¡Œè°ƒè¯•ï¼ˆcharlesï¼‰

### 8.4.1 å¸¸è§çš„ä»£ç†æœåŠ¡å™¨

- Fiddler
  - C#ç¼–å†™
  - æ­£å¼ç‰ˆä»…æ”¯æŒWindows
  - è¯·æ±‚å±•ç¤ºï¼šæ—¶é—´é¡ºåº
  - æ”¯æŒè§£æHTTPSè¯·æ±‚
  - å…è´¹

- Charles
  - javaç¼–å†™
  - å¤šå¹³å°æ”¯æŒ
  - è¯·æ±‚å±•ç¤ºï¼šæ ‘çŠ¶ç»“æ„
  - ä¸æ”¯æŒç›´æ¥è§£æHTTPSè¯·æ±‚
  -  ä»˜è´¹è·å¾—æ›´å¥½ä½“éªŒ

### 8.4.2 HTTPæŠ“åŒ…

1. ç§»åŠ¨ç«¯é…ç½®ï¼ˆé…ç½®ä»£ç†ï¼‰

ç‚¹å‡»æ‰‹æœºè¿æ¥çš„Wi-Fi->HTTPä»£ç†->é…ç½®ä»£ç†

- æœåŠ¡å™¨ï¼šå¡«å…¥ç”µè„‘çš„ipåœ°å€(å¯ä»¥åœ¨charlesæŸ¥çœ‹ help->Local IP Address)
- ç«¯å£ï¼šé»˜è®¤æ˜¯8888

2. å¼€å§‹æŠ“åŒ…

å·¥å…·æ ç¬¬äºŒä¸ªæŒ‰é’®ï¼ˆçº¢è‰²è¯´æ˜æ­£åœ¨æŠ“åŒ…ï¼‰

![](~@/engineering/charles1.png)

### 8.4.3 HTTPSæŠ“åŒ…

charlesä¸èƒ½ç›´æ¥æŠ“åŒ…httpsï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œä»¥ä¸‹æ“ä½œ

1. ç§»åŠ¨ç«¯é…ç½®ä»£ç†

 ä¸ä¸Šé¢httpé…ç½®å®Œå…¨ç›¸åŒ

2. æ·»åŠ è¦è§£æçš„åŸŸååˆ—è¡¨

- èœå•æ Proxy-> SSL Proxying Settings
- åœ¨Hostä¸€æ è®¾ç½®è¦è§£æçš„åŸŸåï¼Œä¹Ÿå¯ä»¥*è¡¨ç¤ºæ‰€æœ‰çš„HTTPSéƒ½åšè§£æ,port:443ï¼›ç‚¹å‡»okåé‡å¯charlesã€‚

![](~@/engineering/charles2.png)

<font color="red">**è®¾ç½®åé‡å¯charles**</font>

3. ä¿¡ä»»Charlesæ ¹è¯ä¹¦

- åœ¨ç§»åŠ¨ç«¯ç”¨æµè§ˆå™¨è®¿é—®`https:chls.pro/ssl`ä¸‹è½½è¯ä¹¦æè¿°æ–‡ä»¶
  - å®‰å“ï¼šç›´æ¥å®‰è£…å³å¯
  - IOSï¼š1.åœ¨è®¾ç½®-é€šç”¨-æè¿°æ–‡ä»¶ä¸è®¾ç½®ç®¡ç†ä¸­å®‰è£…è¯ä¹¦ï¼Œ2.ç„¶åå¼€å¯ è®¾ç½®-é€šç”¨-å…³äºæœ¬æœº-é’ˆå¯¹æ ¹è¯ä¹¦å¯ç”¨å®Œå…¨ä¿¡ä»»

ğŸš€ HTTPS åè®®

- https = http + sllï¼ˆsecure  sockets layerï¼‰

å‘é€ä¸€ä¸ªHTTPSè¯·æ±‚çš„è¿‡ç¨‹ç®€å•æ¥è¯´å®¢æˆ·ç«¯æ˜¯å‘æœåŠ¡ç«¯ç´¢å–ä¸€ä¸ªå…¬é’¥æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå…¬é’¥çš„è½½ä½“å°±æ˜¯æ•°å­—è¯ä¹¦ï¼›å®¢æˆ·ç«¯é€šè¿‡å…¬é’¥åŠ å¯†ï¼ŒæœåŠ¡ç«¯é€šè¿‡ç§é’¥è§£å¯†ã€‚

ğŸš€ charles ä»£ç†HTTPSè¯·æ±‚çš„æœºåˆ¶

charlesåšå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä¸­ä»‹ï¼Œä»£ç†äº†httpsè¯·æ±‚ï¼›charlesä¼šåŠ¨æ€ä¸ºæ¯ä¸ªæœåŠ¡å™¨ç”Ÿæˆç”±charlesæ ¹è¯ä¹¦ç­¾å‘çš„æ•°å­—è¯ä¹¦ï¼›å½“è¯·æ±‚äº§ç”Ÿæ—¶å®¢æˆ·ç«¯æ”¶åˆ°çš„ä¸æ˜¯
æœåŠ¡ç«¯çš„åŸå§‹è¯ä¹¦è€Œæ˜¯charlesç­¾å‘çš„è¯ä¹¦ï¼ŒåŸå§‹è¯ä¹¦æ˜¯ä¿å­˜åœ¨charlesä¸Šçš„ï¼›å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡æ˜¯ç”±charleså…¬é’¥åŠ å¯†çš„ï¼Œè€Œcharlesä¸åŸå§‹æœåŠ¡å™¨çš„é€šä¿¡æ˜¯
ç”±æœåŠ¡ç«¯çš„åŸå§‹è¯ä¹¦åŠ å¯†çš„ï¼Œcharlesé€šè¿‡è‡ªå·±çš„ç§é’¥è§£å¯†ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½é€šè¿‡charlesçœ‹è§æœªåŠ å¯†çš„æ•°æ®ã€‚

ğŸš€  å¯èƒ½å‡ºç°çš„é—®é¢˜

1. å¼€å¯åç”µè„‘æµè§ˆå™¨æ— æ³•æ‰“å¼€ç½‘é¡µ

å…³æ‰charlesçš„External Proxy settingï¼šç‚¹å‡»é¡¶éƒ¨Proxy-> å»æ‰å‹¾é€‰ External Proxy Settings

2. å¼€å¯åæ‰‹æœºæµè§ˆå™¨æ— æ³•æ‰“å¼€ç½‘é¡µ

æ£€æµ‹é¡¶éƒ¨Proxy-> macOS Proxy æ˜¯å¦å‹¾é€‰ï¼›éœ€è¦å‹¾é€‰ï¼ˆwindowåç§°ä¸ä¸€æ ·ï¼‰ï¼›

æ‰“å¼€ç½‘ç»œåå¥½è®¾ç½®-> é«˜çº§ -> ä»£ç† -> æ£€æµ‹ç½‘é¡µä»£ç†å’Œå®‰å…¨ç½‘é¡µä»£ç†æ˜¯å¦å¼€å¯ï¼ˆéœ€è¦å¼€å¯ï¼‰

3. å…³é—­charleså æ— æ³•è”ç½‘

æ‰“å¼€ç½‘ç»œåå¥½è®¾ç½®-> é«˜çº§ -> ä»£ç† -> æ£€æµ‹ç½‘é¡µä»£ç†å’Œå®‰å…¨ç½‘é¡µä»£ç†æ˜¯å¦å¼€å¯ï¼ˆä¸éœ€è¦å¼€å¯ï¼‰

4. æŠ“å–æ‰‹æœºç«¯çš„è¿”å›çš„æ˜¯unknow

- ç¡®ä¿è¯ä¹¦åœ¨æ‰‹æœºç«¯è¢«ä¿¡ä»»

-  safariæµè§ˆå™¨è®¿é—®`https:chls.pro/ssl`ä¸‹è½½è¯ä¹¦æè¿°æ–‡ä»¶æ—¶å€™ï¼Œç¡®ä¿é…ç½®äº†httpä»£ç†ï¼ˆip:8888ï¼‰ï¼Œ
å¦‚æœæ¢ç”µè„‘éœ€è¦å†æ¬¡ä¸‹è½½è¯ä¹¦ï¼Œå¯ä»¥åœ¨æè¿°æ–‡ä»¶ä¸­æŸ¥çœ‹è¯ä¹¦ï¼Œcharlesé€šç”¨åç§°ä¸­ä¼šåŒ…å«ä½ ç”µè„‘ç³»ç»Ÿçš„åç§°

### 8.4.4 Mapè¯·æ±‚é‡å®šå‘

ğŸš€ Map Local / Map Remote

- ç”Ÿäº§ç¯å¢ƒä»£ç æ‰“åŒ…å‹ç¼©åä¸åˆ©äºdebug
- è°ƒè¯•æ—¶ä¸æ–¹ä¾¿é¢‘ç¹å‘å¸ƒ
- `Map Local`ï¼šå°†æŸè¯·æ±‚é‡å®šå‘è‡³æœ¬åœ°æŸä¸ªæ–‡ä»¶
- `Map Remote`ï¼šå°†æŸè¯·æ±‚é‡å®šå‘è‡³å¦ä¸€ä¸ªè¯·æ±‚
- å°†ç”Ÿæˆç¯å¢ƒçš„ä»£ç æ›¿æ¢æˆæœ¬åœ°çš„ä»£ç 

ğŸš€ Map Remote

![](~@/engineering/mapremote.png)

å°è¯•æ”¹åŠ¨ä»£ç ï¼ŒæŸ¥çœ‹é¡µé¢å˜åŒ–

ğŸš€ Map Local

![](~@/engineering/maplocal.png)

Map Localå¯ä»¥æ›¿æ¢ä»»æ„charlesèƒ½æŠ“åŒ…åˆ°çš„æ–‡ä»¶ï¼Œç”šè‡³å¯ä»¥å°†apiè¯·æ±‚æ›¿æ¢æˆæœ¬åœ°çš„jsonæ–‡ä»¶ï¼Œåšæ¥å£çš„ä¸€ä¸ªmockï¼Œ
å…¶å®å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶çš„ä»£ç†åŠŸèƒ½ã€‚

å¦‚æœæƒ³å–æ¶ˆMap Local / Map Remoteï¼šcharlesé¡¶éƒ¨tools-> Map Local / Map Remote -> ä¸å‹¾é€‰enable map local/Remote-> ok

### 8.4.5 Rewrite ä¿®æ”¹è¯·æ±‚å†…å®¹

ğŸš€ RewriteåŠŸèƒ½

- å¯ä½œç”¨äºï¼šrequest & reponses
- å¯ä¿®æ”¹ï¼šheaderã€hostã€pathã€urlã€paramsã€bodyç­‰
- é‡‡ç”¨æ–°å¢ã€æ›¿æ¢çš„å½¢å¼

ğŸš€ æ¡ˆä¾‹

å‘ç”Ÿäº§ç¯å¢ƒé¡µé¢æ³¨å…¥vConsoleè„šæœ¬

1. é¡¶éƒ¨tools-> Rewrite 

æ·»åŠ åŒ¹é…location
![](~@/engineering/rewrite1.png)

æ·»åŠ rewriteè§„åˆ™

![](~@/engineering/rewrite2.png)

å°†headæ ‡ç­¾æ›¿æ¢æˆ<script src="åœ°å€">new VConsole()</script></head>

## 8.5 åœ¨å…¬ç½‘è®¿é—®æœ¬åœ°æœåŠ¡

### 8.5.1 å†…ç½‘ç©¿é€

#### ä»€ä¹ˆå«å†…ç½‘ç©¿é€

-  NATï¼ˆNetwork Address Translationï¼‰ç©¿é€ 
- ä»å…¬ç½‘è®¿é—®å†…ç½‘
- åœ¨å…¬ç½‘è®¿é—®éƒ¨ç½²åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„æœåŠ¡
- ngrok & localtunnel
  - ç”Ÿæˆå”¯ä¸€å¯åœ¨å…¬ç½‘è®¿é—®çš„urlï¼Œè¯¥urlä¼šåœ¨ä»£ç†æœ¬åœ°è¿è¡Œçš„webæœåŠ¡è¯·æ±‚

### 8.5.2 localtunnelçš„ä½¿ç”¨

1. å®‰è£…

```bash
    npm install -g localtunnel
    lt --help # å¸®åŠ©ä¿¡æ¯
```

2. å¯åŠ¨

```bash
    # -p æœ¬åœ°å¯åŠ¨æœåŠ¡çš„ç«¯å£ï¼Œ-s æŒ‡å®šè‡ªå·±å­åŸŸååœ°å€ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®š
    lt -p 3000 -h https://tunnel.svrx.io -s mayi
    # å¯åŠ¨æˆåŠŸå your url is: https://mayi.tunnel.svrx.io
    # è®¿é—®åœ°å€ https://mayi.tunnel.svrx.io
```
### 8.5.3 éƒ¨ç½²ä½ çš„localtunnelæœåŠ¡

- localtunnelé»˜è®¤æœåŠ¡åœ¨å¤–å›½ï¼Œä¸ç¨³å®šï¼Œè®¿é—®é€Ÿåº¦æ…¢
- è‡ªå·±éƒ¨ç½²ltæœåŠ¡çš„æœºå™¨éœ€è¦æ»¡è¶³ï¼š
  1. æ”¯æŒDNSæ³›åŸŸåè§£æï¼Œæ¯”å¦‚ï¼šmydomain.com å’Œ *.mydomain.com
  2. LocaltunnelæœåŠ¡ç«¯èƒ½ç›‘å¬ä»»ä½•érootæƒé™çš„TCPç«¯å£

1. é…ç½®dnsè§£æ
    æ·»åŠ ä¸¤ä¸ªAç±»è®°å½• 
    -  mydomain.com
    - *.mydomain.com

2. å¯åŠ¨localtunnel server

```bash
    git clone git://github.com/defunctzombie/localtunnel-server.git
    cd localtunnel-server
    npm install
    bin/server --port 1234
    bin/server --port 1234 --domain sub.mydomain.com
```
3. åœ¨localtunnelå®¢æˆ·ç«¯ä½¿ç”¨éƒ¨ç½²çš„host

```bash
    lt --host http://sub.mydomain.com:1234  --port 8000
```

