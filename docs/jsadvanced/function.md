## 2.1 javaScriptå†…å­˜ç®¡ç†

### 2.1.1 jså†…å­˜æœºåˆ¶

ğŸ”¥å†…å­˜ç©ºé—´ï¼šæ ˆå†…å­˜ï¼ˆstackï¼‰ã€å †å†…å­˜ï¼ˆheapï¼‰

1. æ ˆå†…å­˜ï¼šæ‰€æœ‰åŸå§‹æ•°æ®ç±»å‹éƒ½å­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­ï¼Œå¦‚æœåˆ é™¤ä¸€ä¸ªæ ˆåŸå§‹æ•°æ®ï¼Œéµå¾ªå…ˆè¿›åå‡ºï¼›å¦‚ä¸‹å›¾ï¼šaæœ€å…ˆè¿›æ ˆï¼Œæœ€åå‡ºæ ˆã€‚
![](~@/jsasvanced/stack.png)

2. å †å†…å­˜ï¼šå¼•ç”¨æ•°æ®ç±»å‹ä¼šåœ¨å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªç©ºé—´ï¼Œå¹¶ä¸”ä¼šæœ‰ä¸€ä¸ªåå…­è¿›åˆ¶çš„å†…å­˜åœ°å€ï¼Œåœ¨æ ˆå†…å­˜ä¸­å£°æ˜çš„å˜é‡çš„å€¼å°±æ˜¯åå…­è¿›åˆ¶çš„å†…å­˜åœ°å€ã€‚

![](~@/jsasvanced/heap.png)

 å‡½æ•°ä¹Ÿæ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å®šä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šåœ¨å †å†…å­˜ä¸­å¼€è¾Ÿç©ºé—´ï¼Œä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼å­˜å‚¨åˆ°å †å†…å­˜ä¸­å»ï¼Œå¦‚ä¸‹å›¾ï¼š
 
 ![](~@/jsasvanced/function.png)

 ```javascript
 // æˆ‘ä»¬ç›´æ¥æ‰“å°fnä¼šå‡ºç°ä¸€æ®µå­—ç¬¦çªœ
 console.log(fn)
  f fn() {
      var t=10;
      var f=10;
      console.log(i+j)
  }
  // åŠ ä¸Šæ‹¬å·æ‰æ‰§è¡Œé‡Œé¢çš„ä»£ç 
  fn() // 20
  ```
 
### 2.1.2 åƒåœ¾å›æ”¶
 ğŸ”¥æ¦‚å¿µï¼šï¼ˆæˆ‘ä»¬å¹³æ—¶åˆ›å»ºæ‰€æœ‰çš„æ•°æ®ç±»å‹éƒ½éœ€è¦å†…å­˜ï¼‰
   æ‰€è°“çš„åƒåœ¾å›æ”¶å°±æ˜¯æ‰¾å‡ºé‚£äº›ä¸å†ç»§ç»­ä½¿ç”¨çš„å˜é‡ï¼Œç„¶åé‡Šæ”¾å‡ºå…¶æ‰€å ç”¨çš„å†…å­˜ï¼Œåƒåœ¾å›æ”¶ä¼šæŒ‰ç…§å›ºå®šçš„æ—¶é—´é—´éš”å‘¨æœŸæ€§çš„æ‰§è¡Œè¿™ä¸€æ“ä½œã€‚

 ğŸ”¥javaScriptä½¿ç”¨çš„åƒåœ¾å›æ”¶æœºåˆ¶æ¥è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œåƒåœ¾å›æ”¶æ˜¯æŠŠåŒåˆƒå‰‘ï¼›åƒåœ¾å›æ”¶æ˜¯ä¸å¯è§çš„

  -  ä¼˜åŠ¿ï¼šå¯ä»¥å¤§å¹…ç®€åŒ–ç¨‹åºçš„å†…å­˜ç®¡ç†ä»£ç ï¼Œé™ä½ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œå‡å°‘å› é•¿æ—¶é—´è¿è½¬è€Œå¸¦æ¥çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚

  - ä¸è¶³ï¼šç¨‹åºå‘˜æ— æ³•æŒæ§å†…å­˜ï¼Œjavascriptæ²¡æœ‰æš´éœ²ä»»ä½•å…³äºå†…å­˜çš„apiï¼Œæ— æ³•å¼ºè¿«è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ— æ³•å¹²é¢„å†…å­˜ç®¡ç†ã€‚

ğŸ”¥ åƒåœ¾å›æ”¶çš„æ–¹å¼

1. å¼•ç”¨è®¡æ•°ï¼ˆreference countingï¼‰

      è·Ÿè¸ªè®°å½•æ¯ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œå¦‚æœä¸€ä¸ªå€¼å¼•ç”¨æ¬¡æ•°æ˜¯0ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªå€¼ä¸å†ç”¨åˆ°äº†ï¼Œå› æ­¤å¯ä»¥å°†è¿™å—å†…å­˜é‡Šæ”¾

      åŸç†ï¼šæ¯æ¬¡å¼•ç”¨åŠ 1ï¼Œè¢«é‡Šæ”¾å‡1ï¼Œå½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å˜æˆ0æ—¶ï¼Œå°±å°†å…¶å†…å­˜ç©ºé—´é‡Šæ”¾ã€‚
 ```javascript
    let obj= {a:10}; // å¼•ç”¨+1
    let obj1={a:10} // å¼•ç”¨+1
    obj ={} //å¼•ç”¨å‡1
    obj1=null //å¼•ç”¨ä¸º0
 ``` 
å¼•ç”¨è®¡æ•°çš„bugï¼šå¾ªç¯å¼•ç”¨
  ```javascript
    // ie8è¾ƒæ—©çš„æµè§ˆå™¨,ç°åœ¨æµè§ˆå™¨ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜
    function Fn (){
        var objA={a:10}
        var objB={b:10}
        objA.c=objB
        objB.c=objA
    }
 ``` 
 2. æ ‡è®°æ¸…é™¤ï¼ˆç°ä»£æµè§ˆé‡‡ç”¨æ ‡è®°æ¸…é™¤çš„æ–¹å¼ï¼‰

 ğŸ”¥æ¦‚å¿µï¼šæ ‡è®°æ¸…é™¤æŒ‡çš„æ˜¯å½“å˜é‡è¿›å…¥ç¯å¢ƒæ—¶ï¼Œè¿™ä¸ªå˜é‡æ ‡è®°ä¸ºâ€œè¿›å…¥ç¯å¢ƒâ€;è€Œå½“å˜é‡ç¦»å¼€ç¯å¢ƒæ—¶ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºâ€œç¦»å¼€ç¯å¢ƒâ€ï¼Œæœ€ååƒåœ¾æ”¶é›†å™¨å®Œæˆå†…å­˜æ¸…é™¤å·¥ä½œï¼Œé”€æ¯é‚£äº›å¸¦æ ‡è®°çš„å€¼å¹¶å›æ”¶å®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼ˆæ‰€è°“çš„ç¯å¢ƒå°±æ˜¯æ‰§è¡Œç¯å¢ƒï¼‰
 
 ğŸ”¥å…¨å±€æ‰§è¡Œç¯å¢ƒ
   - æœ€å¤–å›´çš„æ‰§è¡Œç¯å¢ƒ
   - æ ¹æ®å®¿ä¸»ç¯å¢ƒçš„ä¸åŒè¡¨ç¤ºçš„æ‰§è¡Œç¯å¢ƒçš„å¯¹è±¡ä¹Ÿä¸ä¸€æ ·ï¼Œåœ¨æµè§ˆå™¨ä¸­å…¨å±€æ‰§è¡Œç¯å¢ƒè¢«è®¤ä¸ºæ˜¯windowå¯¹è±¡
   - å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½æ˜¯ä½œä¸ºwindowå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•åˆ›å»ºçš„
   - æŸä¸ªæ‰§è¡Œç¯å¢ƒä¸­çš„æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥ç¯å¢ƒè¢«é”€æ¯ï¼Œä¿å­˜åœ¨å…¶ä¸­çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°å®šä¹‰ä¹Ÿéšä¹‹é”€æ¯ï¼ˆå…¨å±€æ‰§è¡Œç¯å¢ƒåªæœ‰å½“å…³é—­ç½‘é¡µçš„æ—¶å€™æ‰ä¼šè¢«é”€æ¯ï¼‰

  ğŸ”¥ç¯å¢ƒæ ˆï¼ˆå±€éƒ¨ï¼‰
  - æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œç¯å¢ƒï¼Œå½“æ‰§è¡Œæµè¿›å…¥ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå‡½æ•°çš„ç¯å¢ƒå°±ä¼šè¢«æ¨å…¥ä¸€ä¸ªç¯å¢ƒæ ˆä¸­ã€‚è€Œåœ¨å‡½æ•°æ‰§è¡Œä¹‹åï¼Œæ ˆå°†å…¶ç¯å¢ƒå¼¹å‡ºï¼ŒæŠŠæ§åˆ¶æƒè¿”å›ç»™ä¹‹æµ…çš„æ‰§è¡Œç¯å¢ƒï¼ŒECMAScriptç¨‹åºä¸­çš„æ‰§è¡Œæµæ­£å¼ç”±è¿™ä¸ªæ–¹ä¾¿çš„æœºåˆ¶æ§åˆ¶ç€
 
```javascript
    function foo (){
       var a = 10   // è¢«æ ‡è®°è¿›å…¥æ‰§è¡Œç¯å¢ƒ
       var b = â€˜helloâ€™ // è¢«æ ‡è®°è¿›å…¥æ‰§è¡Œç¯å¢ƒ
    }
    foo()  //æ‰§è¡Œå®Œæ¯•ï¼Œa å’Œ b è¢«æ ‡è®°ç¦»å¼€æ‰§è¡Œç¯å¢ƒï¼Œå†…å­˜è¢«å›æ”¶
```
### 2.1.3 V8å†…å­˜ç®¡ç†æœºåˆ¶

  ğŸ”¥V8å¼•æ“é™åˆ¶å†…å­˜çš„åŸå› 
   - V8æœ€åˆä¸ºæµè§ˆå™¨è®¾è®¡ï¼Œä¸å¤ªå¯èƒ½é‡åˆ°å¤§é‡å†…å­˜çš„ä½¿ç”¨åœºæ™¯ï¼ˆè¡¨å±‚åŸå› ï¼‰
   - é˜²æ­¢å› ä¸ºåƒåœ¾å›æ”¶æ‰€å¯¼è‡´çš„çº¿ç¨‹æš‚åœæ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼ˆæ·±å±‚åŸå› ï¼ŒæŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ä»¥1.5Gçš„åƒåœ¾å›æ”¶ä¸ºä¾‹ï¼Œv8åšä¸€æ¬¡å°çš„åƒåœ¾å›æ”¶éœ€è¦50æ¯«ç§’ä»¥ä¸Šï¼Œåšä¸€æ¬¡éå¢é‡çš„åƒåœ¾å›æ”¶éœ€è¦1ç§’ä»¥ä¸Šï¼Œè¿™é‡Œçš„æ—¶é—´æ˜¯æŒ‡javascriptçº¿ç¨‹æš‚åœæ‰§è¡Œçš„æ—¶é—´ï¼Œè¿™æ˜¯ä¸å¯æ¥å—çš„ï¼Œ
   v8ç›´æ¥é™åˆ¶äº†å†…å­˜çš„å¤§å°ï¼Œå¦‚æœè¯´åœ¨node.jsä¸­æ“ä½œå¤§å†…å­˜çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å»ä¿®æ”¹è®¾ç½®å»å®Œæˆï¼Œæˆ–è€…æ˜¯é¿å¼€è¿™ç§é™åˆ¶ï¼Œ1.7gæ˜¯åœ¨v8å¼•æ“æ–¹é¢åšçš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨bufferå¯¹è±¡ï¼Œè€Œbufferå¯¹è±¡çš„å†…å­˜åˆ†é…æ˜¯åœ¨c++å±‚é¢è¿›è¡Œçš„ï¼Œc++çš„å†…å­˜ä¸å—v8çš„é™åˆ¶ï¼‰

  ğŸ”¥V8å›æ”¶ç­–ç•¥
   - v8é‡‡ç”¨å¯ä¸€ç§åˆ†ä»£å›æ”¶çš„ç­–ç•¥ï¼Œå°†å†…å­˜åˆ†ä¸ºä¸¤ä¸ªç”Ÿä»£ï¼›æ–°ç”Ÿä»£å’Œè€ç”Ÿä»£
   - v8åˆ†åˆ«å¯¹æ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ä½¿ç”¨ä¸åŒçš„æ¥åŠå›æ”¶ç®—æ³•æ¥æå‡åƒåœ¾å›æ”¶æ•ˆç‡

  ğŸ”¥æ–°ç”Ÿä»£åƒåœ¾å›æ”¶
  fromå’Œtoç»„æˆä¸€ä¸ª`Semispace`ï¼ˆåŠç©ºé—´ï¼‰å½“æˆ‘ä»¬åˆ†é…å¯¹è±¡æ—¶ï¼Œå…ˆåœ¨fromå¯¹è±¡ä¸­è¿›è¡Œåˆ†é…ï¼Œå½“åƒåœ¾å›æ”¶è¿è¡Œæ—¶å…ˆæ£€æŸ¥fromä¸­çš„å¯¹è±¡ï¼Œå½“`obj2`éœ€è¦å›æ”¶æ—¶å°†å…¶ç•™åœ¨fromç©ºé—´ï¼Œè€Œ`ob1`åˆ†é…åˆ°toç©ºé—´ï¼Œç„¶åè¿›è¡Œåè½¬ï¼Œå°†fromç©ºé—´å’Œtoç©ºé—´è¿›è¡Œäº’æ¢ï¼Œè¿›è¡Œåƒåœ¾
  å›æ”¶æ—¶ï¼Œå°†toç©ºé—´çš„å†…å­˜è¿›è¡Œé‡Šæ”¾ï¼Œç®€è€Œè¨€ä¹‹fromç©ºé—´å­˜æ”¾ä¸è¢«é‡Šæ”¾çš„å¯¹è±¡ï¼Œtoç©ºé—´å­˜æ”¾è¢«é‡Šæ”¾çš„å¯¹è±¡ï¼Œå½“åƒåœ¾å›æ”¶æ—¶å°†toç©ºé—´çš„å¯¹è±¡å…¨éƒ¨è¿›è¡Œå›æ”¶
  ![](~@/jsasvanced/v8.jpg)

  ğŸ”¥æ–°ç”Ÿä»£å¯¹è±¡çš„æ™‹å‡ï¼ˆæ–°ç”Ÿä»£ä¸­ç”¨æ¥å­˜æ”¾ï¼Œç”Ÿå‘½è¾ƒçŸ­çš„å¯¹è±¡ï¼Œè€ç”Ÿä»£å­˜æ”¾ç”Ÿå‘½è¾ƒé•¿çš„å¯¹è±¡ï¼‰
   - åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå½“ä¸€ä¸ªå¯¹è±¡ç»è¿‡å¤šæ¬¡å¤åˆ¶åä¾ç„¶å­˜æ´»ï¼Œå®ƒå°†ä¼šè¢«è®¤ä¸ºæ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼Œéšåä¼šè¢«ç§»åŠ¨åˆ°è€ç”Ÿä»£ä¸­ï¼Œé‡‡å–æ–°çš„ç®—æ³•è¿›è¡Œç®¡ç†
   - åœ¨Fromç©ºé—´å’ŒToç©ºé—´è¿›è¡Œåè½¬çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœToç©ºé—´ä¸­çš„ä½¿ç”¨é‡å·²ç»è¶…è¿‡äº†25%ï¼Œé‚£ä¹ˆå°±å°†Fromä¸­çš„å¯¹è±¡ç›´æ¥æ™‹å‡åˆ°è€ç”Ÿä»£å†…å­˜ç©ºé—´ä¸­

  ğŸ”¥è€ç”Ÿä»£åƒåœ¾å›æ”¶ï¼ˆæœ‰2ç§å›æ”¶æ–¹æ³•ï¼‰
   - è€ç”Ÿä»£å†…å­˜ç©ºé—´æ˜¯ä¸€ä¸ªè¿ç»­çš„ç»“æ„
  ![](~@/jsasvanced/oldshengdai.jpg)
  1. æ ‡è®°æ¸…é™¤ï¼ˆMark Sweepï¼‰
  Mark Sweep æ˜¯å°†éœ€è¦è¢«å›æ”¶çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œåœ¨åƒåœ¾å›æ”¶è¿è¡Œæ—¶ç›´æ¥é‡Šæ”¾ç›¸åº”çš„åœ°å€ç©ºé—´,çº¢è‰²çš„åŒºåŸŸå°±æ˜¯éœ€è¦è¢«å›æ”¶çš„
  ![](~@/jsasvanced/marksweep.jpg)
  - æ ‡è®°åˆå¹¶ï¼ˆMark Compactï¼‰
  Mark Compactå°†å­˜æ´»çš„å¯¹è±¡ç§»åŠ¨åˆ°ä¸€è¾¹ï¼Œå°†éœ€è¦è¢«å›æ”¶çš„å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€è¾¹ï¼Œç„¶åå¯¹éœ€è¦è¢«å›æ”¶çš„å¯¹è±¡åŒºåŸŸè¿›è¡Œæ•´ä½“çš„åƒåœ¾å›æ”¶
  ![](~@/jsasvanced/markconpact.jpg)
  

## 2.2 å¦‚ä½•ä¿è¯ä½ çš„ä»£ç è´¨é‡

### 2.2.1 å•å…ƒæµ‹è¯• (å†™ä¸€æ®µä»£ç å»éªŒè¯å¦ä¸€æ®µä»£ç ï¼Œæ£€æµ‹çš„å¯¹è±¡å¯ä»¥æ˜¯æ ·å¼ã€åŠŸèƒ½ã€ç»„ä»¶ç­‰)

  ğŸ”¥æ¦‚å¿µ
   - æµ‹è¯•ä¸€ç§éªŒè¯æˆ‘ä»¬çš„ä»£ç æ˜¯å¦å¯ä»¥æŒ‰é¢„æœŸå·¥ä½œçš„æ–¹æ³•
   - å•å…ƒæµ‹è¯•æ˜¯å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æµ‹å’ŒéªŒè¯

  ğŸ”¥å‰ç«¯å•å…ƒæµ‹è¯•çš„æ„ä¹‰
   - æ£€æµ‹å‡ºæ½œåœ¨çš„bug
   - å¿«é€Ÿåé¦ˆåŠŸèƒ½è¾“å‡ºï¼ŒéªŒè¯ä»£ç æ˜¯å¦è¾¾åˆ°é¢„æœŸ
   - ä¿è¯ä»£ç é‡æ„çš„å®‰å…¨æ€§
   - æ–¹ä¾¿åä½œå¼€å‘

  ğŸ”¥å•å…ƒæµ‹è¯•ä»£ç 
   1. æ¡ˆä¾‹1

   ``` javascript
        let add=(a,b)=>a+b //è¢«æµ‹è¯•çš„æ–¹æ³•
        let result =add(1,2)
          // å†™çš„æµ‹è¯•çš„ä»£ç 
        let expect=4
        if(result!==expect){
            throw new Error(`1+2åº”è¯¥ç­‰äº${expect},ä½†ç»“æœç¡®æ˜¯${result}`)
        }
      // æœ€åè¾“å‡ºï¼šUncaught Error: 1+2åº”è¯¥ç­‰äº4,ä½†ç»“æœç¡®æ˜¯3 
   ```
  1. æ¡ˆä¾‹2
   ``` javascript
        //è¢«æµ‹è¯•çš„æ–¹æ³•
          let add=(a,b)=>a+b
        // å†™çš„æµ‹è¯•çš„ä»£ç 
          let  expect = (res)=>{
              return {
                  toBe:(actual)=>{
                      if(res!==actual){
                      throw new Error(`é¢„æœŸå€¼å’Œå®é™…å€¼ä¸ç¬¦`)
                    }
                  }
              }
          }

      // expect(add(1,2)).toBe(4)
      let test =(desc,fn)=>{
          try{
              fn()
              console.log(`${desc}é€šè¿‡`); 
          }catch(err){
              console.log(`${desc}æ²¡æœ‰é€šè¿‡`);           
        }
      }
      test('åŠ æ³•æµ‹è¯•',()=>{
          expect(add(1,2)).toBe(3)
      })
      // æœ€åè¾“å‡ºï¼šåŠ æ³•æµ‹è¯•é€šè¿‡ 
   ```      
### 2.2.1 jestçš„åŸºç¡€ä½¿ç”¨ï¼ˆfacebookçš„ä¸€å¥—æµ‹è¯•javascriptçš„æ¡†æ¶ï¼‰
  ğŸ”¥å®‰è£…
   1. å®‰è£…node
   2. yarn add -D jest
   3. æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ npm ls jest

 ğŸ”¥jestçš„åŸºç¡€ä½¿ç”¨
  1. åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶ånpm init -yï¼Œç„¶åä¸‹è½½jestï¼šyarn add -D jest
  2. åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºmath.js,è¿™ä¸ªæ–‡ä»¶æ˜¯å†™è¢«æµ‹è¯•çš„ä»£ç ï¼›å¦‚ä¸‹ï¼š
   ``` javascript
    let  add =(a,b) => a+b
      module.exports= {
          add
      }
   ```
   3. åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºmath.test.jsï¼Œè¿™ä¸ªæ–‡ä»¶å†™æµ‹è¯•ä»£ç ï¼›å¦‚ä¸‹ã€‚
  ``` javascript
        const { add } = require('./math')
        test ('åŠ æ³•æµ‹è¯•',()=>{
            expect(add(1,2)).toBe(3)
        })
   ```
  4. é…ç½®package.jsoné‡Œçš„scriptè„šæœ¬
  ``` javascript
        "scripts": {
         "test": "jest"
        }
  ```
  5. æ‰§è¡Œnpm testï¼Œæµ‹è¯•æˆåŠŸä¼šå‡ºç°ä»¥ä¸‹ä¿¡æ¯
  ``` bash
        PASS  ./math.test.js
        âœ“ åŠ æ³•æµ‹è¯• (3ms)

      Test Suites: 1 passed, 1 total
      Tests:       1 passed, 1 total
      Snapshots:   0 total
      Time:        0.98s
      Ran all test suites.
       
  ```
  æç¤ºï¼šå…·ä½“ä»£ç å¯ä»¥åœ¨æºç test/2.2/jestç›®å½•ä¸‹æŸ¥çœ‹


## 2.3 æé«˜ä»£ç çš„å¯é æ€§

### 2.3.1 å‡½æ•°å¼ç¼–ç¨‹

 ğŸ”¥å«ä¹‰ï¼šå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ˜¯ä¸€ç§æ„å»ºè®¡ç®—æœºç¨‹åºç»“æ„å’Œå…ƒç´ çš„é£æ ¼ï¼Œå®ƒæŠŠè®¡ç®—çœ‹ä½œæ˜¯å¯¹æ•°æ®å‡½æ•°çš„è¯„ä¼°ï¼Œé¿å…äº†çŠ¶æ€çš„å˜åŒ–å’Œæ•°æ®çš„å¯å˜ã€‚
       å°†æˆ‘ä»¬çš„ç¨‹åºåˆ†è§£ä¸ºä¸€äº›æ›´å¯å¤ç”¨ï¼Œæ›´å¯é ä¸”æ›´æ˜“äºç†è§£çš„éƒ¨åˆ†ï¼Œç„¶ååœ¨å°†ä»–ä»¬ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ›´æ˜“æ¨ç†çš„ç¨‹åºæ•´ä½“ã€‚

 1. æ¡ˆä¾‹1:å¯¹ä¸€ä¸ªæ•°ç»„æ¯é¡¹åŠ +1
   ``` javascript
        // åˆçº§ç¨‹åºå‘˜
        let arr =[1,2,3,4]
        let newArr=[]
        for (var i=0;i<arr.length; i++){
          newArr.push(arr[i]+1)
        }
        console.log(newArr) //[2, 3, 4, 5]
  ```
  ``` javascript
      // å‡½æ•°å¼ç¼–ç¨‹
        let arr =[1,2,3,4]
        let newArr =(arr,fn)=>{
            let res=[]
          for (var i=0;i<arr.length; i++){
            res.push(fn(arr[i]))
           }
           return res
        }
        let add= item=>item+1 //æ¯é¡¹åŠ 1
        let multi=item=>item*5 //æ¯é¡¹ä¹˜5
        let sum =newArr(arr,add)
        let product =newArr(arr,multi)
        console.log(sum,product); //Â [2, 3, 4, 5] [5, 10, 15, 20]
  ```
  ### 2.3.2 çº¯å‡½æ•°
  ğŸ”¥å«ä¹‰ï¼šå¦‚æœå‡½æ•°çš„è°ƒç”¨å‚æ•°ç›¸åŒï¼Œåˆ™æ°¸è¿œè¿”å›ç›¸åŒçš„ç»“æœã€‚å®ƒä¸ä¾èµ–äºç¨‹åºæ‰§è¡ŒæœŸé—´å‡½æ•°å¤–éƒ¨ä»»ä½•çŠ¶æ€æˆ–æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»åªä¾èµ–äºå…¶è¾“å…¥çš„å‚æ•°(ç›¸åŒçš„è¾“å…¥ï¼Œå¿…é¡»å¾—åˆ°ç›¸åŒçš„è¾“å‡º)ã€‚
   ``` javascript
        // çº¯å‡½æ•°
        const calculatePrice=ï¼ˆpriceï¼Œdiscountï¼‰=> price * discount
        let price = calculatePriceï¼ˆ200ï¼Œ0ï¼Œ8ï¼‰
        console.log(price)
    ```
    ``` javascript
        // ä¸çº¯å‡½æ•°
        const calculatePrice=ï¼ˆpriceï¼Œdiscountï¼‰=>{
          const dt= new Date().toISOString()
          console.log(`${dt}:${something}`)
          return something
        }
        foo('hello')
  ```
  ### 2.3.3 å‡½æ•°å‰¯ä½œç”¨
  - å½“è°ƒç”¨å‡½æ•°æ—¶ï¼Œé™¤äº†è¿”å›å‡½æ•°å€¼å¤–ï¼Œè¿˜å¯¹æ³¨è°ƒç”¨å‡½æ•°äº§ç”Ÿé™„åŠ çš„å½±å“
  - ä¾‹å¦‚ä¿®æ”¹å…¨å±€å˜é‡ï¼ˆå‡½æ•°å¤–çš„å˜é‡ï¼‰æˆ–ä¿®æ”¹å‚æ•°
    ``` javascript
      //å‡½æ•°å¤–aè¢«æ”¹å˜ï¼Œè¿™å°±æ˜¯å‡½æ•°çš„å‰¯ä½œç”¨
      let a=5
      let foo =ï¼ˆï¼‰=> a = a * 10s
      console.log(a);  // 50
        
      let arr = [1,2,3,4,5,6]
      arr.slice(1,3)  //çº¯å‡½æ•°ï¼Œè¿”å›[1,2],åŸæ•°ç»„ä¸æ”¹å˜
      arr.splice(1,3) // éçº¯å‡½æ•°ï¼Œè¿”å›[2,3,4],åŸæ•°ç»„è¢«æ”¹å˜
      arr.pop() // éçº¯å‡½æ•°ï¼Œè¿”å›6ï¼ŒåŸæ•°ç»„æ”¹å˜
    ```
    ``` javascript
    
      //é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œå¯¹å‡½æ•°è¿›è¡Œæ”¹è¿›ï¼Œæ‰€è°“çš„ä¾èµ–æ³¨å…¥å°±æ˜¯æŠŠä¸å­˜çš„éƒ¨åˆ†ä½œä¸ºå‚æ•°ä¼ å…¥ï¼ŒæŠŠä¸å­˜çš„ä»£ç æå–å‡ºæ¥ï¼›è¿œç¦»çˆ¶å‡½æ•°ï¼›åŒæ—¶è¿™ä¹ˆåšä¸æ˜¯ä¸ºäº†æ¶ˆé™¤å‰¯ä½œç”¨
      //ä¸»è¦æ˜¯ä¸ºäº†æ§åˆ¶ä¸ç¡®å®šæ€§

      const foo =(d,log,something)=>{
        const dt =d.toISOString();
        return log(`${dt}:${something}}`);
      }
      const something ='ä½ å¥½'
      const d= new Date()
      const log =console.log.bind(console)
      foo(d,log,something)
    ```
     ### 2.3.4 å‡½æ•°å‰¯ä½œç”¨å¯å˜æ€§å’Œä¸å¯å˜æ€§
     - å¯å˜æ€§æ˜¯æŒ‡ä¸€ä¸ªå˜é‡åˆ›å»ºä»¥åå¯ä»¥ä»»æ„ä¿®æ”¹
     - ä¸å¯å˜æ€§æŒ‡ä¸€ä¸ªå˜é‡ï¼Œä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±æ°¸è¿œä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä¸å¯å˜æ€§æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µ
    ``` javascript
    // javascriptä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯å˜æ€§ä½¿ç¨‹åºå…·æœ‰ä¸ç¡®å®šæ€§ï¼Œè°ƒç”¨å‡½æ•°fooåï¼Œæˆ‘ä»¬çš„å¯¹è±¡å°±å‘ç”Ÿäº†æ”¹å˜ï¼›è¿™å°±æ˜¯å¯å˜æ€§ï¼Œjsä¸­æ²¡æœ‰åŸç”Ÿçš„ä¸å¯å˜æ€§
      let data={count:1}
      let foo =(data)=>{
        data.count=3
      }
      console.log(data.cont) // 1
      foo(data)
       console.log(data.cont) // 3

      // æ”¹è¿›åä½¿æˆ‘ä»¬çš„æ•°æ®å…·æœ‰ä¸å¯å˜æ€§
      let data={count:1}
      let foo =(data)=>{
        let lily= JSON.parse(JSON.stringify(data)) // leg lily= {...data} ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦å»åšæ‹·è´ï¼Œåªèƒ½æ‹·è´ç¬¬ä¸€å±‚
        lily.count=3
      }
      console.log(data.cont) // 1
      foo(data)
       console.log(data.cont) // 1
    ```
    ## 2.4 composeå‡½æ•°pipeå‡½æ•°

    ### 2.4.1 composeå‡½æ•°
    ğŸ”¥å«ä¹‰ï¼š
    - å°†éœ€è¦åµŒå¥—æ‰§è¡Œçš„å‡½æ•°å¹³é“º
    - åµŒå¥—æ‰§è¡ŒæŒ‡çš„æ˜¯ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼å°†ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°
    ğŸ”¥ä½œç”¨ï¼šå®ç°å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„Pointfree,ä½¿æˆ‘ä»¬ä¸“æ³¨äºè½¬æ¢è€Œä¸æ˜¯æ•°æ®ï¼ˆPointfreeä¸ä½¿ç”¨æ‰€æœ‰å¤„ç†çš„å€¼ï¼Œåªåˆæˆè¿ç®—è¿‡ç¨‹ï¼Œå³æˆ‘ä»¬æ‰€æŒ‡çš„æ— å‚æ•°åˆ†å‰²ï¼‰
    ğŸ”¥æ¡ˆä¾‹ï¼Œè®¡ç®—ä¸€ä¸ªæ•°åŠ 10åœ¨ä¹˜ä»¥10
    ``` javascript
      // ä¸€èˆ¬ä¼šè¿™ä¹ˆåš
      let calculate => x => (x+10) * 10
      console.log(calculate(10)) 

    ```
    ``` javascript
      // ç”¨composeå‡½æ•°å®ç°
        let add = x => x+10
        let multiply = y => y*10
        console.log(multiply(add(10)))

        let compose=function (){
            let args=[].slice.call(arguments)
           
            return function (x) {
                return args.reduceRight(function (total,current) { //ä»å³å¾€å·¦æ‰§è¡Œargsé‡Œçš„å‡½æ•°
                    console.log(total,current)
                   return current(total)
                },x)
            }
        }
        let calculate = compose(multiply,add)
        console.log(calculate,calculate(10)) // 200
    // ç”¨es6å®ç° 
    const compose = (...args) => x=> args.reduceRight((res,cb)=> cb(res),x)
    ```
    ### 2.4.1 pipeå‡½æ•°
     pipeå‡½æ•°composeç±»ä¼¼ï¼Œåªä¸è¿‡ä»å·¦å¾€å³æ‰§è¡Œ

## 2.5 é«˜é˜¶å‡½æ•°
  ğŸ”¥å«ä¹‰ï¼š
  - é«˜é˜¶å‡½æ•°æ˜¯å¯¹å…¶ä»–å‡½æ•°è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œå¯ä»¥å°†å®ƒä»¬ä½œä¸ºå‚æ•°æˆ–è¿”å›å®ƒä»¬
  - ç®€å•æ¥è¯´ï¼Œé«˜é˜¶å‡½æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°æˆ–å°†å‡½æ•°ä½œä¸ºè¾“å‡ºè¿”å› 

  ğŸ”¥map/reduce/filter

  ``` javascript
     // ç”¨redeceåšç´¯åŠ 
      let arr =[1,2,3,4,5]
      let sum =arr.reduce((pre,cur)=>{
        return pre +cur
      },10)

    // ç”¨redeceåšå»é‡
      let arr =[1,2,3,4,5,3,3,4]
      let newArr =arr.reduce((pre,cur)=>{
          pre.indexOf(cur)===-1 && pre.push(cur)
        return pre
      },[])
    console.log(newArr) //[1, 2, 3, 4, 5]
  ```
  ğŸ”¥flat
  ``` javascript
        let arr=[[1,2,3,[23,3,[1,2]]]]
        let arr1=arr.flat(Infinity)   // å¤šç»´è½¬ä¸€ç»´æ•°ç»„
        let arr2=arr.flat(2) // // å¤šç»´è½¬äºŒç»´æ•°ç»„,é»˜è®¤å€¼æ˜¯1
        console.log(arr1,arr2) Â // [1, 2, 3, 23, 3, 1, 2]  [1, 2, 3, 23, 3, Array(2)]
      
  ```
  ğŸ”¥é«˜é˜¶å‡½æ•°çš„æ„ä¹‰
  1. å‚æ•°ä¸ºå‡½æ•°çš„é«˜é˜¶å‡½æ•°
  ``` javascript
        // å‚æ•°ä¸ºå‡½æ•°çš„é«˜é˜¶å‡½æ•°
        function foo (f){
          // åˆ¤æ–­æ˜¯å¦ä¸ºå‡½æ•°
          if((typeof f)==="function"){
            f()
          }
        }
        foo(function(){})   
  ```
  2. è¿”å›å€¼ä¸ºå‡½æ•°çš„é«˜é˜¶å‡½æ•°
  ``` javascript
          // å›å€¼ä¸ºå‡½æ•°çš„é«˜é˜¶å‡½æ•°
          function foo (f){
            rerutn function(){}
          }
          foo()   
  ```
   3. é«˜é˜¶å‡½æ•°çš„å®é™…ä½œç”¨
  ``` javascript
        let callback = (value)=>{
          console.log(value)
        }
        let foo = (value,fn) =>{
          if(typeof fn==='function'){
            fn(value)
          }
        }
        foo('hello',callback)s
  ```
  ## 2.5 å¸¸ç”¨å‡½æ•°

  ### 2.5.1 memozitionï¼ˆç¼“å­˜å‡½æ•°ï¼‰
  ğŸ”¥å«ä¹‰ï¼šç¼“å­˜å‡½æ•°æ˜¯æŒ‡å°†ä¸Šæ¬¡çš„è®¡ç®—ç»“æœç¼“å­˜èµ·æ¥ï¼Œå½“ä¸‹æ¬¡è°ƒç”¨æ—¶ï¼Œå¦‚æœé‡åˆ°ç›¸åŒçš„å‚æ•°ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®
  ``` javascript
      let add = (a ,b) => a+b
      // å‡è®¾memoizeå‡½æ•°å¯ä»¥å®ç°ç¼“å­˜
      let calculate = memoize(add)
      calculate(10,20); // 30
      calculate(10,20); // ç›¸åŒçš„å‚æ•°ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨æ˜¯ï¼Œä»ç¼“å­˜ä¸­å–å‡ºæ•°æ®ï¼Œè€Œå¹¶éé‡æ–°è®¡ç®—ä¸€æ¬¡
  ```
 ğŸ”¥å®ç°åŸç†ï¼šæŠŠå‚æ•°å’Œå¯¹åº”çš„ç»“æœæ•°æ®å­˜åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­å»ï¼Œè°ƒç”¨æ—¶ï¼Œåˆ¤æ–­å‚æ•°å¯¹åº”çš„æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±è¿”å›å¯¹åº”çš„ç»“æœæ•°æ®
  ``` javascript
  // ç¼“å­˜å‡½æ•°
     let memoize =function (func) {
       let cache= {}
       return function (key) {
         if(!cache[key]){
           cache[key] = func.apply(this,arguments)
         }
         return cache[key]
       }
     }
  ```
  ``` javascript
     /*
     *hasherä¹Ÿæ˜¯ä¸ªå‡½æ•°ï¼Œæ˜¯ä¸ºäº†è®¡ç®—keyï¼Œå¦‚æœä¼ å…¥äº†hasherï¼Œå°±ç”¨hasherå‡½æ•°è®¡ç®—keyï¼›
     å¦åˆ™å°±ç”¨memoizeå‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¥ç€å°±å»åˆ¤æ–­å¦‚æœè¿™ä¸ªkeyæ²¡æœ‰è¢«æ±‚å€¼è¿‡ï¼Œå°±å»æ‰§è¡Œï¼Œ
     æœ€åæˆ‘ä»¬å°†è¿™ä¸ªå¯¹è±¡è¿”å›
     */
     let memoize =function (func,hasher) {
       var memoize = function (key) {
         var cache = memoize.cache
         var address='' + (hasher ? hasher.apply(this,arguments) : key)
         var (!cache[address]) chache[address] = func.apply(this,arguments)
         return cache[address]
       }
       memoize.cache={}
       return memoize
     }
     // ç¼“å­˜å‡½æ•°å¯ä»¥æ˜¯fei bo
  ```
  ğŸ”¥æ¡ˆä¾‹ï¼šæ±‚æ–æ³¢é‚£ä¸”æ•°åˆ—
  ``` javascript
      // ä¸ç”¨memoizeçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œ453æ¬¡
      var count=0
      var fibonacci= function (n) {
          count++
          return n < 2? n : fibonacci(n-1) + fibonacci(n-2)
      }
     for (var i=0;i<=10;i++){
        fibonacci(i) //453 
      }
      console.log(count)

    // ç”¨memoizeçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œ12æ¬¡
      let memoize =function (func,hasher) {
       var memoize = function (key) {
         var cache = memoize.cache
         var address= '' + (hasher ? hasher.apply(this,arguments) : key);
         if (!cache[address]) cache[address] = func.apply(this,arguments)
         return cache[address]
       }
       memoize.cache={}
       return memoize
     }
      fibonacci =memoize(fibonacci)  
      for (var i=0;i<=10;i++){
        fibonacci(i) //453 12
      }
      //ç¼“å­˜å‡½æ•°èƒ½åº”ä»˜å¤§é‡é‡å¤è®¡ç®—ï¼Œæˆ–è€…å¤§é‡ä¾èµ–ä¹‹å‰çš„ç»“æœçš„è¿ç®—åœºæ™¯
      console.log(count)
  ```
  ### 2.5.2 curry(æŸ¯é‡ŒåŒ–å‡½æ•°)
  ğŸ”¥å«ä¹‰ï¼šåœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†ä½¿ç”¨å¤šä¸ªå‚æ•°çš„ä¸€ä¸ªå‡½æ•°è½¬æ¢æˆä¸€äº›åˆ—ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„å‡½æ•°æŠ€æœ¯ï¼ˆæŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢æˆå‡ ä¸ªå•ä¸€å‚æ•°çš„å‡½æ•°ï¼‰
   ``` javascript
    // æ²¡æœ‰æŸ¯é‡ŒåŒ–çš„å‡½æ•°
    function girl(name,age,single) {
      return `${name}${age}${single}`
    }
     girl('å¼ ä¸‰')(180)('å•èº«')
     // æŸ¯é‡ŒåŒ–çš„å‡½æ•°
     function girl(name) {
       return function (age){
          return function (single){
            return `${name}${age}${single}`
         }
       }
     }
     girl('å¼ ä¸‰')(180)('å•èº«')
  ```
  ğŸ”¥æ¡ˆä¾‹1ï¼šæ£€æµ‹å­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰ç©ºæ ¼
  ``` javascript
     // å°è£…å‡½æ•°å»æ£€æµ‹
     let matching = (reg,str) => reg.test(str)
     matching(/\s+/g,'hello world') // true
     matching(/\s+/g,'abcdefg') // false
     
     // æŸ¯é‡ŒåŒ–
     let curry = (reg) => {
       return (str) =>{
         return reg.test(str)
       }
     }
    let hasSpace = curry(/\s+/g)
    hasSpace('hello word') // true
    hasSpace('abcdefg') // false
  ```
  ğŸ”¥æ¡ˆä¾‹2ï¼šè·å–æ•°ç»„å¯¹è±¡ä¸­çš„ageçš„å±æ€§å€¼
   ``` javascript
     let persons = [
       {name:'zs',age:21},
       {name:'ls',age:22}
     ]
     // ä¸æŸ¯é‡ŒåŒ–
     let getage = persons.map(item=>{
       return item.age
     })
     // ç”¨loadshçš„curry æ¥å®ç°
     const _=require('loadsh')
     let getProp= _.curry((key,obj)=>{
       return obj[key]
     })
    person.map(getProp('age'))

  ```
  ğŸ”¥æŸ¯é‡ŒåŒ–è¿™ä¸ªæ¦‚å¿µå®ç°æœ¬èº«å°±éš¾ï¼Œå¹³æ—¶å†™ä»£ç å¾ˆéš¾ç”¨åˆ°ï¼Œå…³é”®ç†è§£å…¶æ€æƒ³

  ### 2.5.3 åå‡½æ•°
  ğŸ”¥æ¯”è¾ƒï¼š
  - æŸ¯é‡ŒåŒ–æ˜¯å°†ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°è½¬æ¢æˆå¤šä¸ªå•å‚æ•°çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ªnå…ƒå‡½æ•°è½¬æ¢æˆnä¸ªä¸€å…ƒå‡½æ•°
  - åå‡½æ•°åˆ™å›ºå®šä¸€ä¸ªå‡½æ•°çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ªnå…ƒå‡½æ•°è½¬æ¢æˆä¸€ä¸ªn-xå…ƒçš„å‡½æ•°

  - æŸ¯é‡ŒåŒ–ï¼šf(a,b,c)=f(a)(b)(c)
  - åå‡½æ•°ï¼šf(a,b,c)=f(a,b)(c)
  ``` javascript
    /*
      ç”¨bindå‡½æ•°å®ç°åå‡½æ•°ï¼Œbindçš„å¦ä¸€ä¸ªç”¨æ³•ä½¿ä¸€ä¸ªå‡½æ•°æ‹¥æœ‰é¢„è®¾çš„åˆå§‹å‚æ•°ï¼Œå°†è¿™äº›å‚æ•°å†™åœ¨bindçš„ç¬¬ä¸€ä¸ªå‚æ•°åï¼Œ
      å½“ç»‘å®šå‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šæ’å…¥ç›®æ ‡å‡½æ•°çš„åˆå§‹ä½ç½®ï¼Œè°ƒç”¨å‡½æ•°ä¼ å…¥çš„å‚æ•°ä¼šè·Ÿåœ¨bindä¼ å…¥çš„åé¢
    */
     let add = (x,y) => x+y
     let rst =add.bind(null,1)
     rst(2) //3
  ```
   ## 2.5 é˜²æŠ–å’ŒèŠ‚æµ